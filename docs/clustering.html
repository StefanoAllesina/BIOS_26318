<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lecture 15 Clustering | Fundamentals of Biological Data Analysis</title>
<meta name="author" content="Dmitry Kondrashov and Stefano Allesina">
<meta name="description" content="Goals Learn about partitional clustering Learn about hierarchical clustering Use clustering validation methods Apply different methods to larger data sets library(tidyverse) library(ggfortify)...">
<meta name="generator" content="bookdown 0.24.1 with bs4_book()">
<meta property="og:title" content="Lecture 15 Clustering | Fundamentals of Biological Data Analysis">
<meta property="og:type" content="book">
<meta property="og:description" content="Goals Learn about partitional clustering Learn about hierarchical clustering Use clustering validation methods Apply different methods to larger data sets library(tidyverse) library(ggfortify)...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lecture 15 Clustering | Fundamentals of Biological Data Analysis">
<meta name="twitter:description" content="Goals Learn about partitional clustering Learn about hierarchical clustering Use clustering validation methods Apply different methods to larger data sets library(tidyverse) library(ggfortify)...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.11/header-attrs.js"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.3.0.9000/transition.js"></script><script src="libs/bs3compat-0.3.0.9000/tabs.js"></script><script src="libs/bs3compat-0.3.0.9000/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentals of Biological Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Organization of the class</a></li>
<li><a class="" href="refresher.html"><span class="header-section-number">1</span> Refresher</a></li>
<li><a class="" href="visualizing-data-using-ggplot2.html"><span class="header-section-number">2</span> Visualizing data using ggplot2</a></li>
<li><a class="" href="fundamentals-of-probability.html"><span class="header-section-number">3</span> Fundamentals of probability</a></li>
<li><a class="" href="data-wrangling.html"><span class="header-section-number">4</span> Data wrangling</a></li>
<li><a class="" href="distributions-and-their-properties.html"><span class="header-section-number">5</span> Distributions and their properties</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">6</span> Hypothesis testing</a></li>
<li><a class="" href="likelihood-and-bayes.html"><span class="header-section-number">7</span> Likelihood and Bayes</a></li>
<li><a class="" href="review-of-linear-algebra.html"><span class="header-section-number">8</span> Review of linear algebra</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">9</span> Linear models</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">10</span> ANOVA</a></li>
<li><a class="" href="time-series-modeling-and-forecasting.html"><span class="header-section-number">11</span> Time series: modeling and forecasting</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">12</span> Generalized linear models</a></li>
<li><a class="" href="model-selection.html"><span class="header-section-number">13</span> Model Selection</a></li>
<li><a class="" href="principal-component-analysis.html"><span class="header-section-number">14</span> Principal Component Analysis</a></li>
<li><a class="active" href="clustering.html"><span class="header-section-number">15</span> Clustering</a></li>
<li><a class="" href="building-phylogeneric-trees.html"><span class="header-section-number">16</span> Building phylogeneric trees</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="clustering" class="section level1" number="15">
<h1>
<span class="header-section-number">Lecture 15</span> Clustering<a class="anchor" aria-label="anchor" href="#clustering"><i class="fas fa-link"></i></a>
</h1>
<p><strong>Goals</strong></p>
<ul>
<li>Learn about partitional clustering</li>
<li>Learn about hierarchical clustering</li>
<li>Use clustering validation methods</li>
<li>Apply different methods to larger data sets</li>
</ul>
<div class="sourceCode" id="cb802"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/sinhrks/ggfortify">ggfortify</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.sthda.com/english/rpkgs/factoextra">factoextra</a></span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://sites.google.com/site/malikacharrad/research/nbclust-package">NbClust</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://www.unibo.it/sitoweb/christian.hennig/en/">fpc</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va">clustertend</span><span class="op">)</span></code></pre></div>
<div id="k-means-algorithm" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> K-means algorithm<a class="anchor" aria-label="anchor" href="#k-means-algorithm"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>divide data into K clusters</li>
<li>calculate centroids for each</li>
<li>go through each data point until nothing changes
<ul>
<li>calculate distance to each centroid</li>
<li>assign to nearest centroid</li>
<li>recalculate centroids for the two affected clusters</li>
</ul>
</li>
</ul>
<div class="sourceCode" id="cb803"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#set.seed(20)</span>
<span class="va">iris.scaled</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">iris</span><span class="op">[</span>, <span class="op">-</span><span class="fl">5</span><span class="op">]</span><span class="op">)</span>
<span class="va">iris_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">iris.scaled</span>, <span class="fl">3</span><span class="op">)</span>
<span class="va">iris_km</span></code></pre></div>
<pre><code>## K-means clustering with 3 clusters of sizes 53, 50, 47
## 
## Cluster means:
##   Sepal.Length Sepal.Width Petal.Length Petal.Width
## 1  -0.05005221 -0.88042696    0.3465767   0.2805873
## 2  -1.01119138  0.85041372   -1.3006301  -1.2507035
## 3   1.13217737  0.08812645    0.9928284   1.0141287
## 
## Clustering vector:
##   [1] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2
##  [38] 2 2 2 2 2 2 2 2 2 2 2 2 2 3 3 3 1 1 1 3 1 1 1 1 1 1 1 1 3 1 1 1 1 3 1 1 1
##  [75] 1 3 3 3 1 1 1 1 1 1 1 3 3 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1 3 3 3 3 1 3 3 3 3
## [112] 3 3 1 1 3 3 3 3 1 3 1 3 1 3 3 1 3 3 3 3 3 3 1 1 3 3 3 1 3 3 3 1 3 3 3 1 3
## [149] 3 1
## 
## Within cluster sum of squares by cluster:
## [1] 44.08754 47.35062 47.45019
##  (between_SS / total_SS =  76.7 %)
## 
## Available components:
## 
## [1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss"
## [6] "betweenss"    "size"         "iter"         "ifault"</code></pre>
<div class="sourceCode" id="cb805"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">iris_km</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></code></pre></div>
<pre><code>##    
##     setosa versicolor virginica
##   1      0         39        14
##   2     50          0         0
##   3      0         11        36</code></pre>
<div class="sourceCode" id="cb807"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">iris.scaled</span>, cluster <span class="op">=</span> <span class="va">iris_km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>,
ellipse.type <span class="op">=</span> <span class="st">"norm"</span>, geom <span class="op">=</span> <span class="st">"point"</span>, stand <span class="op">=</span> <span class="cn">FALSE</span>, palette <span class="op">=</span> <span class="st">"jco"</span>, ggtheme <span class="op">=</span> <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-341-1.png" width="672"></div>
<div id="assumptions-of-k-means-algorithm" class="section level3" number="15.1.1">
<h3>
<span class="header-section-number">15.1.1</span> Assumptions of K-means algorithm<a class="anchor" aria-label="anchor" href="#assumptions-of-k-means-algorithm"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>There is a meaningful distance measure</li>
<li>Clusters are roughly spherical</li>
<li>Clusters are of similar size</li>
</ul>
<div class="sourceCode" id="cb808"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Generate random data which will be first cluster</span>
<span class="va">clust1</span> <span class="op">&lt;-</span> <span class="fu">data_frame</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span>, y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Generate the second cluster which will ‘surround’ the first cluster</span>
<span class="va">clust2</span> <span class="op">&lt;-</span> <span class="fu">data_frame</span><span class="op">(</span>r <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">15</span>, <span class="fl">.5</span><span class="op">)</span>, 
                     theta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">200</span>, <span class="fl">0</span>, <span class="fl">2</span> <span class="op">*</span> <span class="va">pi</span><span class="op">)</span>,
                 x <span class="op">=</span> <span class="va">r</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">cos</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">r</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Trig.html">sin</a></span><span class="op">(</span><span class="va">theta</span><span class="op">)</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html">select</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span>
<span class="co">#Combine the data</span>
<span class="va">dataset_cir</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">clust1</span>, <span class="va">clust2</span><span class="op">)</span>
<span class="co">#see the plot</span>
<span class="va">dataset_cir</span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-342-1.png" width="672"></div>
<div class="sourceCode" id="cb809"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#Fit the k-means model</span>
<span class="va">k_clust_spher1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">dataset_cir</span>, centers<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="co">#Plot the data and clusters</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataset_cir</span>, 
                  cluster <span class="op">=</span> <span class="va">k_clust_spher1</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>,
             ellipse.type <span class="op">=</span> <span class="st">"norm"</span>, 
             geom <span class="op">=</span> <span class="st">"point"</span>, stand <span class="op">=</span> <span class="cn">FALSE</span>, 
             palette <span class="op">=</span> <span class="st">"jco"</span>, 
             ggtheme <span class="op">=</span> <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-343-1.png" width="672"></div>
<div class="sourceCode" id="cb810"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Make the first cluster with 1000 random values</span>
<span class="va">clust1</span> <span class="op">&lt;-</span> <span class="fu">data_frame</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span>, 
                     y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html">rnorm</a></span><span class="op">(</span><span class="fl">1000</span><span class="op">)</span><span class="op">)</span>
<span class="co"># Keep 10 values together to make the second cluster</span>
<span class="va">clust2</span> <span class="op">&lt;-</span> <span class="fu">data_frame</span><span class="op">(</span>x<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5.1</span>,<span class="fl">5.2</span>,<span class="fl">5.3</span>,<span class="fl">5.4</span>,<span class="fl">5</span>,<span class="fl">5.1</span>,<span class="fl">5.2</span>,<span class="fl">5.3</span>,<span class="fl">5.4</span><span class="op">)</span>,
                     y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">5</span>,<span class="fl">4.9</span>,<span class="fl">4.9</span>,<span class="fl">4.9</span>,<span class="fl">4.9</span>,<span class="fl">4.9</span><span class="op">)</span><span class="op">)</span>
<span class="co">#Combine the data</span>
<span class="va">dataset_uneven</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">clust1</span>,<span class="va">clust2</span><span class="op">)</span>
<span class="va">dataset_uneven</span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">x</span>, y <span class="op">=</span> <span class="va">y</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-344-1.png" width="672"></div>
<div class="sourceCode" id="cb811"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k_clust_spher3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">dataset_uneven</span>, centers<span class="op">=</span><span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">dataset_uneven</span>, 
                  cluster <span class="op">=</span> <span class="va">k_clust_spher3</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>,
             ellipse.type <span class="op">=</span> <span class="st">"norm"</span>, 
             geom <span class="op">=</span> <span class="st">"point"</span>, 
             stand <span class="op">=</span> <span class="cn">FALSE</span>, 
             palette <span class="op">=</span> <span class="st">"jco"</span>, 
             ggtheme <span class="op">=</span> <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-345-1.png" width="672"></div>
</div>
<div id="exercise-pca-sommelier-1" class="section level3" number="15.1.2">
<h3>
<span class="header-section-number">15.1.2</span> Exercise: PCA sommelier<a class="anchor" aria-label="anchor" href="#exercise-pca-sommelier-1"><i class="fas fa-link"></i></a>
</h3>
<p>The file <code>Wine.csv</code> contains several measures made on 178 wines from Piedmont, produced using three different grapes (column <code>Grape</code>, with 1 = Barolo, 2 = Grignolino, 3 = Barbera). Use the 13 measured variables (i.e., all but <code>Grape</code>) to perform a PCA, and use k-means to cluster the data in PC space. Can you recover the right classification of grapes?</p>
<div class="sourceCode" id="cb812"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">wine</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/Wine.csv"</span><span class="op">)</span>
<span class="co"># make into a matrix for PCA</span>
<span class="va">mat</span> <span class="op">&lt;-</span> <span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="op">-</span><span class="va">Grape</span><span class="op">)</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="op">)</span>
<span class="co"># perform PCA by scaling and centering all 13 variables</span>
<span class="va">pca</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">mat</span>, center <span class="op">=</span> <span class="cn">TRUE</span>, scale. <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co"># pca$x contains the coordinates</span>
<span class="co"># let's see how are we doing</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html">cbind</a></span><span class="op">(</span><span class="va">wine</span>, <span class="fu">as_tibble</span><span class="op">(</span><span class="va">pca</span><span class="op">$</span><span class="va">x</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Grape</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-346-1.png" width="672"></div>
<p>Now let’s apply k-means to divide the data into three clusters</p>
<div class="sourceCode" id="cb813"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">cl</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="va">pca</span><span class="op">$</span><span class="va">x</span>, centers <span class="op">=</span> <span class="fl">3</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span><span class="va">wine</span> <span class="op">%&gt;%</span> <span class="fu">add_column</span><span class="op">(</span>cluster <span class="op">=</span> <span class="va">cl</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Grape</span>, y <span class="op">=</span> <span class="va">cluster</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Grape</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_jitter</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-347-1.png" width="672"></div>
<p>You can see that we correctly classify all the wines for grapes 1 and 3, while some of the ones from grape 2 are misclassified.</p>
<div class="sourceCode" id="cb814"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># find convex hull for each cluster</span>
<span class="co"># i.e. minimal convex polygon containing all points</span>
<span class="va">hull</span> <span class="op">&lt;-</span> <span class="va">pca</span><span class="op">$</span><span class="va">x</span> <span class="op">%&gt;%</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">add_column</span><span class="op">(</span>cluster <span class="op">=</span> <span class="va">cl</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">group_by</span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span> <span class="op">%&gt;%</span> 
  <span class="fu">slice</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/grDevices/chull.html">chull</a></span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span><span class="op">)</span>

<span class="co"># plot the convex hulls</span>
<span class="va">pl</span> <span class="op">&lt;-</span> <span class="va">hull</span> <span class="op">%&gt;%</span> <span class="fu">ggplot</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, group <span class="op">=</span> <span class="va">cluster</span>, fill <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">cluster</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_polygon</span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span>
  
<span class="fu">show</span><span class="op">(</span><span class="va">pl</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-348-1.png" width="672"></div>
<div class="sourceCode" id="cb815"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># now add the points</span>
<span class="va">pl</span> <span class="op">+</span> <span class="fu">geom_point</span><span class="op">(</span>data <span class="op">=</span> <span class="va">pca</span><span class="op">$</span><span class="va">x</span> <span class="op">%&gt;%</span> <span class="fu">as_tibble</span><span class="op">(</span><span class="op">)</span> <span class="op">%&gt;%</span> 
         <span class="fu"><a href="https://rdrr.io/pkg/MASS/man/lm.ridge.html">select</a></span><span class="op">(</span><span class="va">PC1</span>, <span class="va">PC2</span><span class="op">)</span> <span class="op">%&gt;%</span> 
         <span class="fu">add_column</span><span class="op">(</span>Grape <span class="op">=</span> <span class="va">wine</span><span class="op">$</span><span class="va">Grape</span>, cluster <span class="op">=</span> <span class="va">cl</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>, 
  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">PC1</span>, y <span class="op">=</span> <span class="va">PC2</span>, colour <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Grape</span><span class="op">)</span>, shape <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">factor</a></span><span class="op">(</span><span class="va">Grape</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-348-2.png" width="672"></div>
<div class="sourceCode" id="cb816"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">cl</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">wine</span><span class="op">$</span><span class="va">Grape</span><span class="op">)</span></code></pre></div>
<pre><code>##    
##      1  2  3
##   1 59  3  0
##   2  0  3 48
##   3  0 65  0</code></pre>
<p>You can see that we are misclassifying the grapes that are at the border of the cluster or nestled among the points belonging to a different grape. But the outcome is quite good: we would have misclassified only 6 wines out of 178 (3.3%).</p>
</div>
</div>
<div id="hierarchical-clustering" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Hierarchical clustering<a class="anchor" aria-label="anchor" href="#hierarchical-clustering"><i class="fas fa-link"></i></a>
</h2>
<div id="agglomerative-clustering" class="section level3" number="15.2.1">
<h3>
<span class="header-section-number">15.2.1</span> Agglomerative clustering<a class="anchor" aria-label="anchor" href="#agglomerative-clustering"><i class="fas fa-link"></i></a>
</h3>
<p>Start with single data points as “clusters,” then iteratively combine the closest pair of clusters. The closeness may be defined in the following ways:</p>
<ol style="list-style-type: decimal">
<li><p>Single Linkage: In single linkage, we define the distance between two clusters as the minimum distance between any single data point in the first cluster and any single data point in the second cluster.</p></li>
<li><p>Complete Linkage: In complete linkage, we define the distance between two clusters to be the maximum distance between any single data point in the first cluster and any single data point in the second cluster.</p></li>
<li><p>Average Linkage: In average linkage, we define the distance between two clusters to be the average distance between data points in the first cluster and data points in the second cluster.</p></li>
<li><p>Centroid Method: In centroid method, the distance between two clusters is the distance between the two mean vectors of the clusters.<br></p></li>
<li><p>Ward’s Method: This method does not directly define a measure of distance between two points or clusters. It is an ANOVA based approach. One-way univariate ANOVAs are done for each variable with groups defined by the clusters at that stage of the process. At each stage, two clusters merge that provide the smallest increase in the combined error sum of squares.</p></li>
</ol>
<div class="sourceCode" id="cb818"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use hcut() which compute hclust and cut the tree</span>
<span class="va">cir_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/hcut.html">hcut</a></span><span class="op">(</span><span class="va">dataset_cir</span>, k <span class="op">=</span> <span class="fl">2</span>, hc_method <span class="op">=</span> <span class="st">"single"</span><span class="op">)</span>
<span class="co"># Visualize dendrogram</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_dend.html">fviz_dend</a></span><span class="op">(</span><span class="va">cir_hc</span>, show_labels <span class="op">=</span> <span class="cn">FALSE</span>, rect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-349-1.png" width="672"></div>
<div class="sourceCode" id="cb819"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Visualize cluster</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">cir_hc</span>, ellipse.type <span class="op">=</span> <span class="st">"convex"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-349-2.png" width="672"></div>
<div class="sourceCode" id="cb820"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use hcut() which compute hclust and cut the tree</span>
<span class="va">uneven_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/hcut.html">hcut</a></span><span class="op">(</span><span class="va">dataset_uneven</span>, k <span class="op">=</span> <span class="fl">2</span>, hc_method <span class="op">=</span> <span class="st">"single"</span><span class="op">)</span>
<span class="co"># Visualize dendrogram</span>
<span class="co">#fviz_dend(uneven_hc, show_labels = FALSE, rect = TRUE)</span>
<span class="co"># Visualize cluster</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">uneven_hc</span>, ellipse.type <span class="op">=</span> <span class="st">"convex"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-350-1.png" width="672"></div>
</div>
<div id="cluster-the-irises-using-hierarchical-methods" class="section level3" number="15.2.2">
<h3>
<span class="header-section-number">15.2.2</span> Cluster the irises using hierarchical methods<a class="anchor" aria-label="anchor" href="#cluster-the-irises-using-hierarchical-methods"><i class="fas fa-link"></i></a>
</h3>
<p>Try different methods and see which one generates the best results</p>
<div class="sourceCode" id="cb821"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Hierarchical clustering</span>
<span class="co"># ++++++++++++++++++++++++</span>
<span class="co"># Use hcut() which compute hclust and cut the tree</span>
<span class="va">iris_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/hcut.html">hcut</a></span><span class="op">(</span><span class="va">iris.scaled</span>, k <span class="op">=</span> <span class="fl">3</span>, hc_method <span class="op">=</span> <span class="st">"single"</span><span class="op">)</span>
<span class="co"># Visualize dendrogram</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_dend.html">fviz_dend</a></span><span class="op">(</span><span class="va">iris_hc</span>, show_labels <span class="op">=</span> <span class="cn">FALSE</span>, rect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-351-1.png" width="672"></div>
<div class="sourceCode" id="cb822"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Visualize cluster</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">iris_hc</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-351-2.png" width="672"></div>
<div class="sourceCode" id="cb823"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">iris_hc</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">iris</span><span class="op">$</span><span class="va">Species</span><span class="op">)</span></code></pre></div>
<pre><code>##    
##     setosa versicolor virginica
##   1     49          0         0
##   2      1          0         0
##   3      0         50        50</code></pre>
</div>
<div id="taste-the-wine-again" class="section level3" number="15.2.3">
<h3>
<span class="header-section-number">15.2.3</span> Taste the wine again!<a class="anchor" aria-label="anchor" href="#taste-the-wine-again"><i class="fas fa-link"></i></a>
</h3>
<p>For the wine data set, use hierarchical clustering on the PCA - reduced data set and compare the results to the complete data set. Which hierarchical clustering method performs the best?</p>
</div>
</div>
<div id="clustering-analysis-and-validation" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Clustering analysis and validation<a class="anchor" aria-label="anchor" href="#clustering-analysis-and-validation"><i class="fas fa-link"></i></a>
</h2>
<div id="hopkins-statistic" class="section level3" number="15.3.1">
<h3>
<span class="header-section-number">15.3.1</span> Hopkins statistic<a class="anchor" aria-label="anchor" href="#hopkins-statistic"><i class="fas fa-link"></i></a>
</h3>
<p>Comparing the mean nearest-neighbor distance between uniformly generated sample points and mean nearest-neighbor distance within the data set.
<span class="math display">\[
H = 1 - \frac{\sum u^d_i}{\sum u^d_i + \sum w^d_i}
\]</span>
This quantifies the “clustering tendency” of the data set.</p>
<div class="sourceCode" id="cb825"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Check Cluster Tendency--Hopkins Statistic</span>
<span class="fu"><a href="https://rdrr.io/pkg/clustertend/man/hopkins.html">hopkins</a></span><span class="op">(</span><span class="va">iris.scaled</span>, n <span class="op">=</span> <span class="fl">30</span><span class="op">)</span> <span class="co"># n should be about 20% of the data</span></code></pre></div>
<pre><code>## $H
## [1] 0.1794449</code></pre>
<div class="sourceCode" id="cb827"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># run a couple times to sample repeatedly</span></code></pre></div>
<p>If H is below 0.5 reject the null hypothesis, which is that the data are generated by a Poisson point process (uniformly distributed.)</p>
<div class="sourceCode" id="cb828"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Visual Assessment of Cluster Tendency</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/dist.html">fviz_dist</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/dist.html">dist</a></span><span class="op">(</span><span class="va">iris.scaled</span><span class="op">)</span>, show_labels <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span><span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>title <span class="op">=</span> <span class="st">"Iris Data"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure">
<img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-354-1.png" width="672">
- Red is high similarity (low dissimilarity)
- Blue is low similarity (high dissimilarity)</div>
</div>
<div id="elbow-method" class="section level3" number="15.3.2">
<h3>
<span class="header-section-number">15.3.2</span> Elbow method<a class="anchor" aria-label="anchor" href="#elbow-method"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb829"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Elbow method</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_nbclust.html">fviz_nbclust</a></span><span class="op">(</span><span class="va">iris.scaled</span>, <span class="va">kmeans</span>, method <span class="op">=</span> <span class="st">"wss"</span><span class="op">)</span> <span class="op">+</span> <span class="fu">geom_vline</span><span class="op">(</span>xintercept <span class="op">=</span> <span class="fl">2</span>, linetype <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">+</span>
<span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Elbow method for K-means"</span><span class="op">)</span></code></pre></div>
<p><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-355-1.png" width="672">
### Silhouette Plot
Measures how similar an object <span class="math inline">\(i\)</span> is to the other objects in its same cluster versus the objects outside of its cluster; <span class="math inline">\(S_i\)</span> values range from -1 to 1. Close to 1 means very similar to objects in its own group and dissimilar to others</p>
<div class="sourceCode" id="cb830"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Silhouette method</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_nbclust.html">fviz_nbclust</a></span><span class="op">(</span><span class="va">iris.scaled</span>, <span class="va">kmeans</span>, method <span class="op">=</span> <span class="st">"silhouette"</span><span class="op">)</span><span class="op">+</span> <span class="fu">labs</span><span class="op">(</span>subtitle <span class="op">=</span> <span class="st">"Silhouette method for k-means"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-356-1.png" width="672"></div>
</div>
<div id="lazy-way-use-all-the-methods" class="section level3" number="15.3.3">
<h3>
<span class="header-section-number">15.3.3</span> Lazy way: use all the methods!<a class="anchor" aria-label="anchor" href="#lazy-way-use-all-the-methods"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb831"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/NbClust/man/NbClust.html">NbClust</a></span><span class="op">(</span><span class="va">iris.scaled</span>, distance <span class="op">=</span> <span class="st">"euclidean"</span>, min.nc <span class="op">=</span> <span class="fl">2</span>,
        max.nc <span class="op">=</span> <span class="fl">10</span>, method <span class="op">=</span> <span class="st">"kmeans"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-357-1.png" width="672"></div>
<pre><code>## *** : The Hubert index is a graphical method of determining the number of clusters.
##                 In the plot of Hubert index, we seek a significant knee that corresponds to a 
##                 significant increase of the value of the measure i.e the significant peak in Hubert
##                 index second differences plot. 
## </code></pre>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-357-2.png" width="672"></div>
<pre><code>## *** : The D index is a graphical method of determining the number of clusters. 
##                 In the plot of D index, we seek a significant knee (the significant peak in Dindex
##                 second differences plot) that corresponds to a significant increase of the value of
##                 the measure. 
##  
## ******************************************************************* 
## * Among all indices:                                                
## * 11 proposed 2 as the best number of clusters 
## * 10 proposed 3 as the best number of clusters 
## * 1 proposed 4 as the best number of clusters 
## * 1 proposed 6 as the best number of clusters 
## * 1 proposed 10 as the best number of clusters 
## 
##                    ***** Conclusion *****                            
##  
## * According to the majority rule, the best number of clusters is  2 
##  
##  
## *******************************************************************</code></pre>
<div class="sourceCode" id="cb834"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_nbclust.html">fviz_nbclust</a></span><span class="op">(</span><span class="va">nb</span><span class="op">)</span></code></pre></div>
<pre><code>## Among all indices: 
## ===================
## * 2 proposed  0 as the best number of clusters
## * 11 proposed  2 as the best number of clusters
## * 10 proposed  3 as the best number of clusters
## * 1 proposed  4 as the best number of clusters
## * 1 proposed  6 as the best number of clusters
## * 1 proposed  10 as the best number of clusters
## 
## Conclusion
## =========================
## * According to the majority rule, the best number of clusters is  2 .</code></pre>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-357-3.png" width="672"></div>
</div>
<div id="validation" class="section level3" number="15.3.4">
<h3>
<span class="header-section-number">15.3.4</span> Validation<a class="anchor" aria-label="anchor" href="#validation"><i class="fas fa-link"></i></a>
</h3>
<p>One common approach to validating clustering is to use the approach called bootstrapping which involves repeatedly sampling from the data set, running the clustering algorithm and comparing the results. One algorithm uses the Jaccard coefficient to quantify similarity between sets, which is defined as the number of points in the intersection of the two sets (those which are in both sets), divided by the number of points in the union of the two sets (the point that are in either one or the other set):</p>
<p><span class="math display">\[
J = \frac{ \vert A \cap B \vert }{\vert A \cup B \vert}
\]</span>
The vertical lines indicate the number of points (cardinality) in the set.</p>
<div class="sourceCode" id="cb836"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">k</span> <span class="op">&lt;-</span> <span class="fl">3</span>
<span class="va">cboot.hclust</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/fpc/man/clusterboot.html">clusterboot</a></span><span class="op">(</span><span class="va">iris.scaled</span>, clustermethod<span class="op">=</span><span class="va">kmeansCBI</span>, k<span class="op">=</span> <span class="va">k</span><span class="op">)</span></code></pre></div>
<pre><code>## boot 1 
## boot 2 
## boot 3 
## boot 4 
## boot 5 
## boot 6 
## boot 7 
## boot 8 
## boot 9 
## boot 10 
## boot 11 
## boot 12 
## boot 13 
## boot 14 
## boot 15 
## boot 16 
## boot 17 
## boot 18 
## boot 19 
## boot 20 
## boot 21 
## boot 22 
## boot 23 
## boot 24 
## boot 25 
## boot 26 
## boot 27 
## boot 28 
## boot 29 
## boot 30 
## boot 31 
## boot 32 
## boot 33 
## boot 34 
## boot 35 
## boot 36 
## boot 37 
## boot 38 
## boot 39 
## boot 40 
## boot 41 
## boot 42 
## boot 43 
## boot 44 
## boot 45 
## boot 46 
## boot 47 
## boot 48 
## boot 49 
## boot 50 
## boot 51 
## boot 52 
## boot 53 
## boot 54 
## boot 55 
## boot 56 
## boot 57 
## boot 58 
## boot 59 
## boot 60 
## boot 61 
## boot 62 
## boot 63 
## boot 64 
## boot 65 
## boot 66 
## boot 67 
## boot 68 
## boot 69 
## boot 70 
## boot 71 
## boot 72 
## boot 73 
## boot 74 
## boot 75 
## boot 76 
## boot 77 
## boot 78 
## boot 79 
## boot 80 
## boot 81 
## boot 82 
## boot 83 
## boot 84 
## boot 85 
## boot 86 
## boot 87 
## boot 88 
## boot 89 
## boot 90 
## boot 91 
## boot 92 
## boot 93 
## boot 94 
## boot 95 
## boot 96 
## boot 97 
## boot 98 
## boot 99 
## boot 100</code></pre>
<div class="sourceCode" id="cb838"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">cboot.hclust</span><span class="op">)</span></code></pre></div>
<pre><code>## * Cluster stability assessment *
## Cluster method:  kmeans 
## Full clustering results are given as parameter result
## of the clusterboot object, which also provides further statistics
## of the resampling results.
## Number of resampling runs:  100 
## 
## Number of clusters found in data:  3 
## 
##  Clusterwise Jaccard bootstrap (omitting multiple points) mean:
## [1] 0.9328980 0.8346651 0.8318038
## dissolved:
## [1]  1  5 12
## recovered:
## [1] 83 75 79</code></pre>
<div class="sourceCode" id="cb840"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#cboot.hclust &lt;- clusterboot(bcdata, clustermethod=hclustCBI,</span>
       <span class="co">#                    method="single", k=2)</span></code></pre></div>
</div>
</div>
<div id="application-to-breast-cancer-data" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> Application to breast cancer data<a class="anchor" aria-label="anchor" href="#application-to-breast-cancer-data"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb841"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Import Breast Cancer Data Set</span>
<span class="va">fulldata</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="st">"data/Wisconsin_Breast_Cancers.csv"</span><span class="op">)</span>
<span class="va">bcdata</span> <span class="op">&lt;-</span> <span class="va">fulldata</span><span class="op">[</span>,<span class="fl">2</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span>
<span class="va">class</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/array.html">array</a></span><span class="op">(</span>data<span class="op">=</span> <span class="va">fulldata</span><span class="op">[</span>,<span class="fl">11</span><span class="op">]</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">fulldata</span><span class="op">)</span></code></pre></div>
<pre><code>## # A tibble: 6 x 11
##    Sample Clump_Thickness Size_Uniformity Shape_Uniformity Marginal_Adhesion
##     &lt;dbl&gt;           &lt;dbl&gt;           &lt;dbl&gt;            &lt;dbl&gt;             &lt;dbl&gt;
## 1 1000025               5               1                1                 1
## 2 1002945               5               4                4                 5
## 3 1015425               3               1                1                 1
## 4 1016277               6               8                8                 1
## 5 1017023               4               1                1                 3
## 6 1017122               8              10               10                 8
## # … with 6 more variables: Single_Epithelial_Cell_Size &lt;dbl&gt;,
## #   Bare_Nuclei &lt;dbl&gt;, Bland_Chromatin &lt;dbl&gt;, Normal_Nucleoli &lt;dbl&gt;,
## #   Mitoses &lt;dbl&gt;, Class &lt;dbl&gt;</code></pre>
<div class="sourceCode" id="cb843"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Visually Inspect Data (PCA)</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_pca.html">fviz_pca_ind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/prcomp.html">prcomp</a></span><span class="op">(</span><span class="va">bcdata</span><span class="op">)</span>, title <span class="op">=</span> <span class="st">"PCA - Breast Cancer data"</span>, geom <span class="op">=</span> <span class="st">"point"</span>, ggtheme <span class="op">=</span> <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-360-1.png" width="672"></div>
<div class="sourceCode" id="cb844"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">bc_km</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/kmeans.html">kmeans</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">bcdata</span><span class="op">)</span>, <span class="fl">2</span><span class="op">)</span>
<span class="va">bc_km</span></code></pre></div>
<pre><code>## K-means clustering with 2 clusters of sizes 453, 231
## 
## Cluster means:
##   Clump_Thickness Size_Uniformity Shape_Uniformity Marginal_Adhesion
## 1      -0.4973081      -0.6104358       -0.6062297        -0.5191788
## 2       0.9752406       1.1970884        1.1888401         1.0181299
##   Single_Epithelial_Cell_Size Bare_Nuclei Bland_Chromatin Normal_Nucleoli
## 1                  -0.5133379  -0.5896356      -0.5498977       -0.531641
## 2                   1.0066757   1.1562984       1.0783707        1.042569
##      Mitoses
## 1 -0.3070638
## 2  0.6021640
## 
## Clustering vector:
##   [1] 1 2 1 2 1 2 1 1 1 1 1 1 1 1 2 2 1 1 2 1 2 2 1 1 1 1 1 1 1 1 1 2 1 1 1 2 1
##  [38] 2 2 2 2 2 2 1 2 1 1 2 2 1 2 2 2 2 2 1 1 1 2 1 2 1 1 2 1 2 2 1 1 2 1 2 2 1
##  [75] 1 1 1 1 1 1 1 1 2 2 2 2 1 1 1 1 1 1 1 1 1 1 2 2 2 1 1 1 2 2 2 2 1 2 1 2 2
## [112] 2 1 1 1 2 1 1 1 1 2 2 2 1 2 1 2 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 1 2 1 2
## [149] 2 1 1 2 1 1 2 2 1 1 1 1 2 2 1 1 1 1 1 2 2 2 1 2 1 1 1 1 1 2 2 1 2 2 2 1 2
## [186] 2 1 1 1 1 2 1 1 1 2 2 1 1 1 2 2 1 1 1 2 2 1 2 2 2 1 1 2 1 1 2 1 2 2 1 2 2
## [223] 1 2 2 2 1 2 1 2 2 2 2 1 1 1 1 1 1 2 1 1 1 2 2 2 2 2 1 1 1 2 2 2 2 2 2 1 2
## [260] 2 2 1 2 1 2 1 1 1 1 1 2 1 1 2 2 2 2 2 1 2 2 1 1 2 2 2 1 2 2 1 2 1 2 2 1 1
## [297] 2 1 1 1 2 1 1 2 2 1 2 2 1 2 1 1 1 1 2 2 2 1 1 2 2 1 2 1 1 2 2 1 1 1 2 1 1
## [334] 1 1 2 1 1 2 2 1 1 1 2 2 2 2 2 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1
## [371] 1 1 2 1 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 1 1 1 2 1 2 1 2 1 1 1 1 2
## [408] 1 1 1 2 1 2 1 1 1 1 1 1 2 2 2 1 1 1 2 1 1 1 1 1 1 1 1 2 1 1 1 2 1 1 2 2 1
## [445] 1 1 1 1 1 1 2 2 2 1 1 1 1 1 1 1 1 1 1 1 2 1 1 2 2 1 1 1 2 2 1 1 2 1 2 1 1
## [482] 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 1 2 2 1 1 1 2 1 1 2 2 1 1 1 1 1 1 2 1 1
## [519] 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 2 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 2 2
## [556] 2 2 1 1 2 1 1 1 1 1 1 2 2 1 1 1 2 1 2 1 2 2 2 1 2 1 1 1 1 1 1 1 1 2 2 2 1
## [593] 1 2 1 2 2 2 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 2 1 1 2 1 1 1 1 1 1 1 1
## [630] 1 1 1 2 1 1 1 1 1 1 1 1 2 2 1 1 1 1 1 1 1 1 1 2 2 2 1 1 1 1 1 1 1 1 1 2 2
## [667] 1 1 1 1 1 1 1 1 1 2 1 1 1 1 2 2 2 2
## 
## Within cluster sum of squares by cluster:
## [1]  573.108 2156.785
##  (between_SS / total_SS =  55.6 %)
## 
## Available components:
## 
## [1] "cluster"      "centers"      "totss"        "withinss"     "tot.withinss"
## [6] "betweenss"    "size"         "iter"         "ifault"</code></pre>
<div class="sourceCode" id="cb846"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">bc_km</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">fulldata</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></code></pre></div>
<pre><code>##    
##       2   4
##   1 434  19
##   2  10 221</code></pre>
<div class="sourceCode" id="cb848"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">#irisCluster$cluster &lt;- as.factor(irisCluster$cluster)</span>
<span class="co">#ggplot(iris, aes(Petal.Length, Petal.Width, color = iris$cluster)) + geom_point()</span>

<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bcdata</span>, cluster <span class="op">=</span> <span class="va">bc_km</span><span class="op">$</span><span class="va">cluster</span><span class="op">)</span>,
ellipse.type <span class="op">=</span> <span class="st">"norm"</span>, geom <span class="op">=</span> <span class="st">"point"</span>, stand <span class="op">=</span> <span class="cn">FALSE</span>, palette <span class="op">=</span> <span class="st">"jco"</span>, ggtheme <span class="op">=</span> <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-361-1.png" width="672"></div>
<div class="sourceCode" id="cb849"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Use hcut() which compute hclust and cut the tree</span>
<span class="va">bc_hc</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/hcut.html">hcut</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/scale.html">scale</a></span><span class="op">(</span><span class="va">bcdata</span><span class="op">)</span>, k <span class="op">=</span> <span class="fl">2</span>, hc_method <span class="op">=</span> <span class="st">"ward"</span><span class="op">)</span>
<span class="co"># Visualize dendrogram</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_dend.html">fviz_dend</a></span><span class="op">(</span><span class="va">bc_hc</span>, show_labels <span class="op">=</span> <span class="cn">FALSE</span>, rect <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-362-1.png" width="672"></div>
<div class="sourceCode" id="cb850"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Visualize cluster</span>
<span class="fu"><a href="https://rdrr.io/pkg/factoextra/man/fviz_cluster.html">fviz_cluster</a></span><span class="op">(</span><span class="va">bc_hc</span>, ellipse.type <span class="op">=</span> <span class="st">"convex"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-362-2.png" width="672"></div>
<div class="sourceCode" id="cb851"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="va">bc_hc</span><span class="op">$</span><span class="va">cluster</span>, <span class="va">fulldata</span><span class="op">$</span><span class="va">Class</span><span class="op">)</span></code></pre></div>
<pre><code>##    
##       2   4
##   1 412   2
##   2  32 238</code></pre>
</div>
<div id="references-1" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> References:<a class="anchor" aria-label="anchor" href="#references-1"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li><a href="https://www.r-bloggers.com/exploring-assumptions-of-k-means-clustering-using-r/" class="uri">https://www.r-bloggers.com/exploring-assumptions-of-k-means-clustering-using-r/</a></li>
<li><a href="https://onlinecourses.science.psu.edu/stat505/node/143/" class="uri">https://onlinecourses.science.psu.edu/stat505/node/143/</a></li>
<li><a href="https://github.com/hhundiwala/hierarchical-clustering" class="uri">https://github.com/hhundiwala/hierarchical-clustering</a></li>
<li><a href="https://www.r-bloggers.com/bootstrap-evaluation-of-clusters/" class="uri">https://www.r-bloggers.com/bootstrap-evaluation-of-clusters/</a></li>
</ol>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="principal-component-analysis.html"><span class="header-section-number">14</span> Principal Component Analysis</a></div>
<div class="next"><a href="building-phylogeneric-trees.html"><span class="header-section-number">16</span> Building phylogeneric trees</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#clustering"><span class="header-section-number">15</span> Clustering</a></li>
<li>
<a class="nav-link" href="#k-means-algorithm"><span class="header-section-number">15.1</span> K-means algorithm</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#assumptions-of-k-means-algorithm"><span class="header-section-number">15.1.1</span> Assumptions of K-means algorithm</a></li>
<li><a class="nav-link" href="#exercise-pca-sommelier-1"><span class="header-section-number">15.1.2</span> Exercise: PCA sommelier</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#hierarchical-clustering"><span class="header-section-number">15.2</span> Hierarchical clustering</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#agglomerative-clustering"><span class="header-section-number">15.2.1</span> Agglomerative clustering</a></li>
<li><a class="nav-link" href="#cluster-the-irises-using-hierarchical-methods"><span class="header-section-number">15.2.2</span> Cluster the irises using hierarchical methods</a></li>
<li><a class="nav-link" href="#taste-the-wine-again"><span class="header-section-number">15.2.3</span> Taste the wine again!</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#clustering-analysis-and-validation"><span class="header-section-number">15.3</span> Clustering analysis and validation</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#hopkins-statistic"><span class="header-section-number">15.3.1</span> Hopkins statistic</a></li>
<li><a class="nav-link" href="#elbow-method"><span class="header-section-number">15.3.2</span> Elbow method</a></li>
<li><a class="nav-link" href="#lazy-way-use-all-the-methods"><span class="header-section-number">15.3.3</span> Lazy way: use all the methods!</a></li>
<li><a class="nav-link" href="#validation"><span class="header-section-number">15.3.4</span> Validation</a></li>
</ul>
</li>
<li><a class="nav-link" href="#application-to-breast-cancer-data"><span class="header-section-number">15.4</span> Application to breast cancer data</a></li>
<li><a class="nav-link" href="#references-1"><span class="header-section-number">15.5</span> References:</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentals of Biological Data Analysis</strong>" was written by Dmitry Kondrashov and Stefano Allesina. It was last built on 2021-09-24.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
