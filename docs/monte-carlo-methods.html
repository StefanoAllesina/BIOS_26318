<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lecture 18 Monte Carlo methods | Fundamentals of Biological Data Analysis</title>
<meta name="author" content="Dmitry Kondrashov and Stefano Allesina">
<meta name="description" content="The Monte Carlo casino refused to admit me until I was properly dressed so I went and found my stockings, and then came back and lost my shirt. — Dorothy Parker  18.1 Idea In statistics, Monte...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="Lecture 18 Monte Carlo methods | Fundamentals of Biological Data Analysis">
<meta property="og:type" content="book">
<meta property="og:description" content="The Monte Carlo casino refused to admit me until I was properly dressed so I went and found my stockings, and then came back and lost my shirt. — Dorothy Parker  18.1 Idea In statistics, Monte...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lecture 18 Monte Carlo methods | Fundamentals of Biological Data Analysis">
<meta name="twitter:description" content="The Monte Carlo casino refused to admit me until I was properly dressed so I went and found my stockings, and then came back and lost my shirt. — Dorothy Parker  18.1 Idea In statistics, Monte...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentals of Biological Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Organization of the class</a></li>
<li><a class="" href="refresher.html"><span class="header-section-number">1</span> Refresher</a></li>
<li><a class="" href="visualizing-data-using-ggplot2.html"><span class="header-section-number">2</span> Visualizing data using ggplot2</a></li>
<li><a class="" href="fundamentals-of-probability.html"><span class="header-section-number">3</span> Fundamentals of probability</a></li>
<li><a class="" href="data-wrangling.html"><span class="header-section-number">4</span> Data wrangling</a></li>
<li><a class="" href="distributions-and-their-properties.html"><span class="header-section-number">5</span> Distributions and their properties</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">6</span> Hypothesis testing</a></li>
<li><a class="" href="likelihood-and-bayes.html"><span class="header-section-number">7</span> Likelihood and Bayes</a></li>
<li><a class="" href="review-of-linear-algebra.html"><span class="header-section-number">8</span> Review of linear algebra</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">9</span> Linear models</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">10</span> ANOVA</a></li>
<li><a class="" href="model-selection.html"><span class="header-section-number">11</span> Model Selection</a></li>
<li><a class="" href="principal-component-analysis.html"><span class="header-section-number">12</span> Principal Component Analysis</a></li>
<li><a class="" href="clustering.html"><span class="header-section-number">13</span> Clustering</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">14</span> Generalized linear models</a></li>
<li><a class="" href="machine-learning-methods-for-classification.html"><span class="header-section-number">15</span> Machine learning methods for classification</a></li>
<li><a class="" href="building-phylogeneric-trees.html"><span class="header-section-number">16</span> Building phylogeneric trees</a></li>
<li><a class="" href="time-series-modeling-and-forecasting.html"><span class="header-section-number">17</span> Time series: modeling and forecasting</a></li>
<li><a class="active" href="monte-carlo-methods.html"><span class="header-section-number">18</span> Monte Carlo methods</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="monte-carlo-methods" class="section level1" number="18">
<h1>
<span class="header-section-number">Lecture 18</span> Monte Carlo methods<a class="anchor" aria-label="anchor" href="#monte-carlo-methods"><i class="fas fa-link"></i></a>
</h1>
<blockquote>
<p><em>The Monte Carlo casino refused to admit me until I was properly dressed so I went and found my stockings, and then came back and lost my shirt.</em></p>
<p>— Dorothy Parker</p>
</blockquote>
<div id="idea" class="section level2" number="18.1">
<h2>
<span class="header-section-number">18.1</span> Idea<a class="anchor" aria-label="anchor" href="#idea"><i class="fas fa-link"></i></a>
</h2>
<p>In statistics, Monte Carlo methods are computational methods in which repeated, random sampling is used for estimation or hypothesis testing.</p>
<p>They are often used when:</p>
<ul>
<li>We have small data sizes, and thus (asymptotic) convergence to known distribution is not known.</li>
<li>We want to apply a permutation test, but there are too many permutations.</li>
<li>Build posterior distributions from Bayesian calculations.</li>
<li>Determine confidence intervals for parameters that are difficult to calculate.</li>
<li>Test hypotheses on data that are not distributed according to convenient, well-studied distributions.</li>
<li>etc.</li>
</ul>
</div>
<div id="history" class="section level2" number="18.2">
<h2>
<span class="header-section-number">18.2</span> History<a class="anchor" aria-label="anchor" href="#history"><i class="fas fa-link"></i></a>
</h2>
<p>Though examples of what we would call today Monte Carlo methods can be dated back centuries, the idea was formalized by scientists working on the Manhattan Project, and especially Stanislaw Ulam (the inventor of MCMC; the program <code>stan</code> is named after him), Johnny Von Neumann and Nicholas Metropolis (who came up with the name <em>Monte Carlo</em>, a reference to the famous casino).</p>
<p>These methods have found applications in all the sciences, and beyond.</p>
</div>
<div id="bootstrapping" class="section level2" number="18.3">
<h2>
<span class="header-section-number">18.3</span> Bootstrapping<a class="anchor" aria-label="anchor" href="#bootstrapping"><i class="fas fa-link"></i></a>
</h2>
<p>The idea is to build confidence intervals for (complex) metrics by repeatedly re-sampling the data (with replacement), thereby mimicking the sampling process. This method was pioneered by Bradley Efron (“Bootstrap Methods: Another Look at the Jackknife” <em>Ann. Statist.</em> 1979).</p>
<p>The basic algorithm is as follows:</p>
<ul>
<li>We have a data set of size <span class="math inline">\(n\)</span>, and we want to compute a certain metric on the data.</li>
<li>We iteratively re-sample the data (with repetition), each time obtaining a sample of size <span class="math inline">\(n\)</span>
</li>
<li>We compute the metric for the re-sampled data sets, thus building a distribution for the metric.</li>
<li>We can compute statistics on the distribution (e.g., percentiles, confidence intervals, etc.)</li>
</ul>
<div id="example-1" class="section level3" number="18.3.1">
<h3>
<span class="header-section-number">18.3.1</span> Example 1<a class="anchor" aria-label="anchor" href="#example-1"><i class="fas fa-link"></i></a>
</h3>
<p>We are going to use data on number of bears found per quadrat, found in a small island in Foxe Basin, Canada, which is occupied by a high density of bears during the summer ice-free season. The data, collected using satellite imagery, is taken from Stapleton S. et al. (“Polar Bears from Space: Assessing Satellite Imagery as a Tool to Track Arctic Wildlife” <em>PLoS ONE</em> 2014), and the analysis follows the presentation in Fieberg, J.D. et al. (“Resampling-based methods for biologists” <em>PeerJ</em> 2020).</p>
<p>Let’s load the data:</p>
<div class="sourceCode" id="cb953"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">bears</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/bears.csv"</span><span class="op">)</span></span>
<span><span class="va">num_bears</span> <span class="op">&lt;-</span> <span class="va">bears</span><span class="op">$</span><span class="va">Num.Bears</span></span></code></pre></div>
<p>and compute the mean number of bears per quadrat</p>
<div class="sourceCode" id="cb954"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">num_bears</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0.5609756</code></pre>
<p>and count the number of quadrats</p>
<div class="sourceCode" id="cb956"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">num_bears</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 164</code></pre>
<p>What should we expect for the mean if we had access to only 75 quadrats? We can bootstrap the data? we can approach this by repeatedly sampling 75 quadrats out of the 164 and measure the distribution of the means:</p>
<div class="sourceCode" id="cb958"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_means</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">num_bears</span>, <span class="fl">75</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># this is the average of the sampled means</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sample_means</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0.56288</code></pre>
<div class="sourceCode" id="cb960"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># typically, confidence intervals are taken to be +/- 2 * sd/sqrt(n)</span></span>
<span><span class="va">confidence</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">sample_means</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/stats/sd.html">sd</a></span><span class="op">(</span><span class="va">sample_means</span><span class="op">)</span><span class="op">/</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">sqrt</a></span><span class="op">(</span><span class="fl">75</span><span class="op">)</span></span>
<span><span class="va">confidence</span></span></code></pre></div>
<pre><code>## [1] 0.5449954 0.5807646</code></pre>
</div>
</div>
<div id="example-2" class="section level2" number="18.4">
<h2>
<span class="header-section-number">18.4</span> Example 2<a class="anchor" aria-label="anchor" href="#example-2"><i class="fas fa-link"></i></a>
</h2>
<p>Another example, taken from Fieberg et al. </p>
<blockquote>
<p>[Consider the] data collected by the Minnesota Department of Natural Resources to explore the potential impact of changing fishing regulations on the size distribution of northern pike (Esox lucius) in Medicine Lake, an approximately 460-acre lake in Beltrami County, MN. In 1989, the MN DNR instituted a slot limit of 22–30 inches in this lake (i.e., all caught fish within this size interval had to be released). We consider length data from 73 and 81 fish collected in trap nets in 1988 and 1993, respectively (before and after the fishing regulation was put in place). Importantly, these data come from only one lake, and many other factors may have changed between 1988 and 1993. Therefore, we must be cautious when interpreting any changes in the distribution of fish sizes (i.e., attributing the cause of length changes to the management regulation or generalizing results to other lakes). Nonetheless, we can ask, “How much did fish length, on average, change between 1988 and 1993 in Medicine Lake?” To address this question, we estimate the difference in the mean length of fish in the two samples. We also quantify our uncertainty in this estimated difference in means, recognizing that we would get a different estimate if we could go back and collect other samples of fish in those 2 years.</p>
</blockquote>
<p>Let’s read the data</p>
<div class="sourceCode" id="cb962"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dt</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/Pikedata.csv"</span><span class="op">)</span></span></code></pre></div>
<p>And divide it by year</p>
<div class="sourceCode" id="cb963"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">y1988</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">$</span><span class="va">length.inches</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1988</span><span class="op">]</span></span>
<span><span class="va">y1993</span> <span class="op">&lt;-</span> <span class="va">dt</span><span class="op">$</span><span class="va">length.inches</span><span class="op">[</span><span class="va">dt</span><span class="op">$</span><span class="va">year</span> <span class="op">==</span> <span class="fl">1993</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y1993</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y1988</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 2.581708</code></pre>
<p>Showing that fish in 1993 were 2.6 inches longer. Because we caught a small number of fish (about 80) per year, we can build a distribution for the difference by bootstrapping</p>
<div class="sourceCode" id="cb965"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">sample_mean</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="va">x</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="va">diff_sample</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html">replicate</a></span><span class="op">(</span><span class="fl">1000</span>, <span class="fu">sample_mean</span><span class="op">(</span><span class="va">y1993</span><span class="op">)</span> <span class="op">-</span> <span class="fu">sample_mean</span><span class="op">(</span><span class="va">y1988</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span><span class="op">(</span><span class="va">diff_sample</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html">abline</a></span><span class="op">(</span>v <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y1993</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">y1988</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-417-1.png" width="672"></div>
</div>
<div id="hypothesis-testing-using-monte-carlo" class="section level2" number="18.5">
<h2>
<span class="header-section-number">18.5</span> Hypothesis testing using Monte Carlo<a class="anchor" aria-label="anchor" href="#hypothesis-testing-using-monte-carlo"><i class="fas fa-link"></i></a>
</h2>
<p>These methods are often used when we can easily sample from the null model (i.e., a model encoding the null hypothesis), and we want to compute some statistics on the observed data v. the randomized data. We can associate an “empirical” p-value to the test, by measuring how often the statistics on the randomized data exceeds that measured for the empirical data.</p>
<div id="example-penguin-breeding-pairs" class="section level3" number="18.5.1">
<h3>
<span class="header-section-number">18.5.1</span> Example: penguin breeding pairs<a class="anchor" aria-label="anchor" href="#example-penguin-breeding-pairs"><i class="fas fa-link"></i></a>
</h3>
<p>This example is taken from Graeme Ruxton &amp; Markus Neuhäuser (“Improving the reporting of P-values generated by randomization methods”, <em>Methods in Eco &amp; Evol</em> 2013).</p>
<blockquote>
<p>Massaro &amp; Blair (<em>New Zealand J. Ecol</em>, 2003) wanted to compare the numbers of breeding yellow-eyed penguins (<em>Megadyptes antipodes</em>) on Stewart Island off New Zealand with those on nearby islands, which (unlike Stewart Island) had no feral cats (<em>Felis catus</em>) that are potential predators of the penguins. They visited 19 breeding colonies on Stewart island and recorded the following numbers of breeding pairs at them {7,3,3,7,3,7,3,10,1,7,4,1,3,2,1,2,9,4,2}, and 10 colonies on nearby islands where the recorded numbers of pairs were {15,32,1,13,14,11,1,3,2,7}. Thus, in total, 178 breeding pairs were observed; on Stewart Island, the mean colony size (±SE) was 4.2 (±0.6), whereas on other islands, it was 9.9 (±3). We want to explore by randomization whether this sample gives reason for rejecting the null hypothesis that each pair chooses a breeding site (independently) without regard to the presence of cats. […] Given the noticeably lower variability among colony sizes on Stewart Island, an appropriate test statistic to adopt might be the <em>t</em> statistic for samples with unequal variance (Ruxton 2006). For each randomization, each of the 178 pairs independently chooses one of the 29 colonies (each with equal probability).</p>
</blockquote>
<p>In a nutshell, the idea is to</p>
<ol style="list-style-type: decimal">
<li>measure the t statistics for the observed data</li>
<li>repeatedly generate randomized data by assigning the 178 pairs to the colonies at random</li>
<li>measure the t statistics for the randomized data, forming a distribution</li>
<li>compute the (empirical) probability of finding a value for the randomized data that is larger than that found for the observed data</li>
</ol>
<div class="sourceCode" id="cb966"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">original</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">7</span>,<span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">7</span>,<span class="fl">3</span>,<span class="fl">7</span>,<span class="fl">3</span>,<span class="fl">10</span>,<span class="fl">1</span>,<span class="fl">7</span>,<span class="fl">4</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">1</span>,<span class="fl">2</span>,<span class="fl">9</span>,<span class="fl">4</span>,<span class="fl">2</span><span class="op">)</span>, <span class="co"># Stewart Island</span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">15</span>,<span class="fl">32</span>,<span class="fl">1</span>,<span class="fl">13</span>,<span class="fl">14</span>,<span class="fl">11</span>,<span class="fl">1</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">7</span><span class="op">)</span> <span class="co"># other island</span></span>
<span>              <span class="op">)</span></span>
<span><span class="co"># compute t-stat for original data [first 19 are one island, the rest are the other island]</span></span>
<span><span class="va">tobs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">original</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">19</span><span class="op">]</span>, <span class="va">original</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">statistic</span><span class="op">)</span></span>
<span><span class="co"># now randomized the data and record the number of times we've found a value larger than the </span></span>
<span><span class="co"># one observed for the empirical data</span></span>
<span><span class="va">num_rand</span> <span class="op">&lt;-</span> <span class="fl">999</span></span>
<span><span class="va">p_value</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">num_rand</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">randomized</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/table.html">table</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">29</span>, <span class="fl">178</span>, replace <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="va">trnd</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/MathFun.html">abs</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/t.test.html">t.test</a></span><span class="op">(</span><span class="va">randomized</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">19</span><span class="op">]</span>, <span class="va">randomized</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">19</span><span class="op">)</span><span class="op">]</span><span class="op">)</span><span class="op">$</span><span class="va">statistic</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">trnd</span> <span class="op">&gt;=</span> <span class="va">tobs</span><span class="op">)</span> <span class="va">p_value</span> <span class="op">&lt;-</span> <span class="va">p_value</span> <span class="op">+</span> <span class="fl">1</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">p_value</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 61</code></pre>
<p>In this case, we have observed a larger (or equal) value 61 times out of 999 randomizations. The last step is to divide this number by the number of simulations, to obtain a probability. There are two ways to do this:</p>
<p><span class="math display">\[
p = \frac{\sum_i{I(x_i \geq X})}{n}
\]</span></p>
<p>where <span class="math inline">\(x_i\)</span> is the statistics for randomization <span class="math inline">\(i\)</span>, <span class="math inline">\(X\)</span> is the statistics for the observed data, and <span class="math inline">\(n\)</span> is the number of randomizations. In this case:</p>
<div class="sourceCode" id="cb968"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">p_value</span> <span class="op">/</span> <span class="fl">999</span></span></code></pre></div>
<pre><code>## [1] 0.06106106</code></pre>
<p>Alternatively, and slightly more conservatively, we can assume that the empirical data was also sampled from the null model, in which case:</p>
<p><span class="math display">\[
p = \frac{1+ \sum_i{I(x_i \geq X})}{n + 1}
\]</span></p>
<p>yielding:</p>
<div class="sourceCode" id="cb970"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">p_value</span><span class="op">)</span> <span class="op">/</span> <span class="fl">1000</span></span></code></pre></div>
<pre><code>## [1] 0.062</code></pre>
<p>The difference between the two approaches is largest when the probability of observing a large value in the randomizations is very small (in one case we would get <span class="math inline">\(0\)</span>, in the other <span class="math inline">\(1/(n+1)\)</span>). Ruxton &amp; Neuhäuser recommend stating the choice explicitly, to improve replicability. A discussion of this issue in the field of genetics can be found in North <em>et al.</em> (“A Note on the Calculation of Empirical P Values from Monte Carlo Procedures”, <em>Am J Hum Genet</em> 2002); Gandy (“Sequential implementation of Monte Carlo Tests with uniformly bounded resampling risk” <em>Journal of the American Statistical Association</em> 2000) provides an algorithm to compute confidence intervals on the empirical p-value.</p>
<p>Naturally, the larger the number of simulations, the more accurate the result. The rule of thumb is that one would need about <span class="math inline">\(10^4\)</span> randomizations to be confident in the first two decimals.</p>
</div>
</div>
<div id="randomizing-binary-tables-bipartite-networks" class="section level2" number="18.6">
<h2>
<span class="header-section-number">18.6</span> Randomizing binary tables (bipartite networks)<a class="anchor" aria-label="anchor" href="#randomizing-binary-tables-bipartite-networks"><i class="fas fa-link"></i></a>
</h2>
<p>Often, biological data is represented by binary, rectangular tables. For example:</p>
<ul>
<li>Rows are sampling sites, and columns are species; a 1 marks the presence of a species at a site, and a 0 its absence.</li>
<li>Rows are individuals and columns are SNPs.</li>
<li>Rows are species and columns are traits.</li>
<li>Rows are genes and columns are times; a 1 marks genes that are significantly over-expressed at a given time.</li>
<li>…</li>
</ul>
<p>These data can be represented as either a binary, rectangular matrix, or equivalently as a bipartite network.</p>
<p>One of the most salient feature of such a table is given by its marginal totals (row/col sums, or the degree of the nodes in the bipartite network). The marginal totals/degrees greatly influence the network/table structure. For example, in extreme cases there is only one binary table/network with a given set of degrees.</p>
<div class="sourceCode" id="cb972"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,</span>
<span>  <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,</span>
<span>  <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,</span>
<span>  <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,</span>
<span>  <span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span></span>
<span><span class="op">)</span>, <span class="fl">5</span>, <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span></span>
<span>  <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,</span>
<span>  <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,</span>
<span>  <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">1</span>,</span>
<span>  <span class="fl">1</span>,<span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,</span>
<span>  <span class="fl">1</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span></span>
<span><span class="op">)</span>, <span class="fl">5</span>, <span class="fl">4</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="va">A</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    1    1    1
## [2,]    1    1    1    0
## [3,]    1    1    1    0
## [4,]    1    1    0    0
## [5,]    1    0    0    0</code></pre>
<div class="sourceCode" id="cb974"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">B</span></span></code></pre></div>
<pre><code>##      [,1] [,2] [,3] [,4]
## [1,]    1    1    1    1
## [2,]    1    1    1    0
## [3,]    1    1    0    1
## [4,]    1    1    0    0
## [5,]    1    0    0    0</code></pre>
<div id="randomizing-the-network-checkerboard-swapping" class="section level3" number="18.6.1">
<h3>
<span class="header-section-number">18.6.1</span> Randomizing the network: checkerboard swapping<a class="anchor" aria-label="anchor" href="#randomizing-the-network-checkerboard-swapping"><i class="fas fa-link"></i></a>
</h3>
<p>If we can identify two rows and two columns such that the induced submatrix is</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th></th>
<th>a</th>
<th>b</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>0</td>
<td>1</td>
</tr>
<tr class="even">
<td>B</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table></div>
<p>or</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th></th>
<th>a</th>
<th>b</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>B</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table></div>
<p>we can swap the submatrix for the other, without altering the row/col marginal totals.</p>
</div>
<div id="randomizing-the-network-curveball" class="section level3" number="18.6.2">
<h3>
<span class="header-section-number">18.6.2</span> Randomizing the network: curveball<a class="anchor" aria-label="anchor" href="#randomizing-the-network-curveball"><i class="fas fa-link"></i></a>
</h3>
<p>The same idea can be generalized. One fun way to think about this, introduced by Strona et al. (“A fast and unbiased procedure to randomize ecological binary matrices with fixed row and column totals” <em>Nature Comm</em> 2014) is to consider children exchanging baseball cards. In the example above, the cards are the columns and the children are the rows, and two children exchange one card (for example, A does not have card b, and B does not have card a; if they exchange them the number of cards per child and the number of children per card are unchanged).</p>
<p>Take two rows of a binary matrix:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th></th>
<th>a</th>
<th>b</th>
<th>c</th>
<th>d</th>
<th>e</th>
<th>f</th>
<th>g</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>A</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
</tr>
<tr class="even">
<td>B</td>
<td>1</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>1</td>
</tr>
</tbody>
</table></div>
<p>The intersection set <span class="math inline">\(A \cap B\)</span> is given by {a,c,d,f,g}, with A contributing two “cards” (d, f) and B contributing three (a,c,g). If we pool all the cards in the intersection, and then A picks two at random, and B the remaining three, the marginals are unchanged.</p>
<p>Clearly, the “mixing” of the table is faster, because we can trade several cards at once. It can be proven that, after a sufficiently large number of trades, the resulting table/network is sampled uniformly from the set of tables/networks with the given marginal totals.</p>
<p>For example, create a random binary table, and shuffle it keeping the marginal totals:</p>
<div class="sourceCode" id="cb976"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/source.html">source</a></span><span class="op">(</span><span class="st">"data/curveball.R"</span><span class="op">)</span></span>
<span><span class="co"># create a random table</span></span>
<span><span class="va">A</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span><span class="op">(</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html">runif</a></span><span class="op">(</span><span class="fl">10</span> <span class="op">*</span> <span class="fl">7</span><span class="op">)</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span>, <span class="fl">10</span>, <span class="fl">7</span><span class="op">)</span></span>
<span><span class="co"># this are the the marginal totals</span></span>
<span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">rowSums</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span></span></code></pre></div>
<pre><code>##  [1] 4 4 3 5 3 4 4 3 2 4</code></pre>
<div class="sourceCode" id="cb978"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/Matrix/man/colSums.html">colSums</a></span><span class="op">(</span><span class="va">A</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 4 5 7 5 2 7 6</code></pre>
<div class="sourceCode" id="cb980"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># randomize the matrix</span></span>
<span><span class="va">B</span> <span class="op">&lt;-</span> <span class="fu">curveball.run</span><span class="op">(</span><span class="va">A</span>, <span class="fl">1000</span><span class="op">)</span></span></code></pre></div>
</div>
<div id="example-darwins-finches" class="section level3" number="18.6.3">
<h3>
<span class="header-section-number">18.6.3</span> Example: Darwin’s finches<a class="anchor" aria-label="anchor" href="#example-darwins-finches"><i class="fas fa-link"></i></a>
</h3>
<p>Jared Diamond proposed that the presence/absence of species on islands would be influenced by competition: bird species would try avoiding overlapping with their competitors, and would tend to co-occur with species they are not competing with. While this idea generated a very contentious debate, here we are going to test this hypothesis using the famous Darwin’s finches (see Weiner, <em>The Beak of the Finch: A Story of Evolution in Our Time</em> 1994), using a metric proposed by Roberts and Stone. Take <span class="math inline">\(A\)</span> to be a matrix with the <span class="math inline">\(m\)</span> finch species as rows, and <span class="math inline">\(n\)</span> islands as columns; a 1 marks the presence of a finch species on an island. The matrix <span class="math inline">\(S = A A^T\)</span> counts the number of islands in which species co-occur. Naturally, the diagonal reports the number of islands in which a finch species is found.</p>
<p>Roberts and Stone proposed to measure:</p>
<p><span class="math display">\[
\bar{S^2} = \frac{1}{m (m-1)} \sum_{i\neq j}S_{ij}^2
\]</span></p>
<p>This number is small if finch species do not co-occurr often, and is high when some species always co-occur. We are going to use the curveball algorithm to randomize the species data, and then compute an empirical p value for the probability of observing this result by chance:</p>
<div class="sourceCode" id="cb981"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">finches</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"data/finches.csv"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co"># compute mean squared overlap, excluding self</span></span>
<span><span class="co"># index proposed by Roberts and Stone, Oecologia 1990</span></span>
<span><span class="va">mean_sq_ol</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">M</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">M2</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">M</span><span class="op">)</span> <span class="co"># number of co-occurrences</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span><span class="op">(</span><span class="va">M2</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NA</span> <span class="co"># no self</span></span>
<span>  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">M2</span><span class="op">^</span><span class="fl">2</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span><span class="co"># observed value</span></span>
<span><span class="va">obs</span> <span class="op">&lt;-</span> <span class="fu">mean_sq_ol</span><span class="op">(</span><span class="va">finches</span><span class="op">)</span></span>
<span><span class="co"># randomizations</span></span>
<span><span class="va">nrand</span> <span class="op">&lt;-</span> <span class="fl">249</span></span>
<span><span class="va">pval</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">nrand</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">tmp</span> <span class="op">&lt;-</span> <span class="fu">mean_sq_ol</span><span class="op">(</span><span class="fu">curveball.run</span><span class="op">(</span><span class="va">finches</span>, <span class="fl">250</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">tmp</span> <span class="op">&gt;=</span> <span class="va">obs</span><span class="op">)</span> <span class="op">{</span> <span class="co"># testing "partitioning/competition" </span></span>
<span>    <span class="va">pval</span> <span class="op">&lt;-</span> <span class="va">pval</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="op">(</span><span class="va">pval</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">nrand</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code>## [1] 0.004</code></pre>
<p>we conclude that our null model (finches choose random islands, considering that some fiches are more widespread than others, and that some islands harbor a larger number of species) would not generate such a high value by chance with high probability, and thus we reject the hypothesis.</p>

</div>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="time-series-modeling-and-forecasting.html"><span class="header-section-number">17</span> Time series: modeling and forecasting</a></div>
<div class="empty"></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#monte-carlo-methods"><span class="header-section-number">18</span> Monte Carlo methods</a></li>
<li><a class="nav-link" href="#idea"><span class="header-section-number">18.1</span> Idea</a></li>
<li><a class="nav-link" href="#history"><span class="header-section-number">18.2</span> History</a></li>
<li>
<a class="nav-link" href="#bootstrapping"><span class="header-section-number">18.3</span> Bootstrapping</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#example-1"><span class="header-section-number">18.3.1</span> Example 1</a></li></ul>
</li>
<li><a class="nav-link" href="#example-2"><span class="header-section-number">18.4</span> Example 2</a></li>
<li>
<a class="nav-link" href="#hypothesis-testing-using-monte-carlo"><span class="header-section-number">18.5</span> Hypothesis testing using Monte Carlo</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#example-penguin-breeding-pairs"><span class="header-section-number">18.5.1</span> Example: penguin breeding pairs</a></li></ul>
</li>
<li>
<a class="nav-link" href="#randomizing-binary-tables-bipartite-networks"><span class="header-section-number">18.6</span> Randomizing binary tables (bipartite networks)</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#randomizing-the-network-checkerboard-swapping"><span class="header-section-number">18.6.1</span> Randomizing the network: checkerboard swapping</a></li>
<li><a class="nav-link" href="#randomizing-the-network-curveball"><span class="header-section-number">18.6.2</span> Randomizing the network: curveball</a></li>
<li><a class="nav-link" href="#example-darwins-finches"><span class="header-section-number">18.6.3</span> Example: Darwin’s finches</a></li>
</ul>
</li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentals of Biological Data Analysis</strong>" was written by Dmitry Kondrashov and Stefano Allesina. It was last built on 2022-11-12.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
