<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Lecture 15 Machine learning methods for classification | Fundamentals of Biological Data Analysis</title>
<meta name="author" content="Dmitry Kondrashov and Stefano Allesina">
<meta name="description" content="15.1 Introduction The classification problem is a very common one in practice, and we have already seen the use of GLMs to systematically predict binary response variables. We have also used...">
<meta name="generator" content="bookdown 0.29 with bs4_book()">
<meta property="og:title" content="Lecture 15 Machine learning methods for classification | Fundamentals of Biological Data Analysis">
<meta property="og:type" content="book">
<meta property="og:description" content="15.1 Introduction The classification problem is a very common one in practice, and we have already seen the use of GLMs to systematically predict binary response variables. We have also used...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Lecture 15 Machine learning methods for classification | Fundamentals of Biological Data Analysis">
<meta name="twitter:description" content="15.1 Introduction The classification problem is a very common one in practice, and we have already seen the use of GLMs to systematically predict binary response variables. We have also used...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.4.0/transition.js"></script><script src="libs/bs3compat-0.4.0/tabs.js"></script><script src="libs/bs3compat-0.4.0/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">Fundamentals of Biological Data Analysis</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Organization of the class</a></li>
<li><a class="" href="refresher.html"><span class="header-section-number">1</span> Refresher</a></li>
<li><a class="" href="visualizing-data-using-ggplot2.html"><span class="header-section-number">2</span> Visualizing data using ggplot2</a></li>
<li><a class="" href="fundamentals-of-probability.html"><span class="header-section-number">3</span> Fundamentals of probability</a></li>
<li><a class="" href="data-wrangling.html"><span class="header-section-number">4</span> Data wrangling</a></li>
<li><a class="" href="distributions-and-their-properties.html"><span class="header-section-number">5</span> Distributions and their properties</a></li>
<li><a class="" href="hypothesis-testing.html"><span class="header-section-number">6</span> Hypothesis testing</a></li>
<li><a class="" href="likelihood-and-bayes.html"><span class="header-section-number">7</span> Likelihood and Bayes</a></li>
<li><a class="" href="review-of-linear-algebra.html"><span class="header-section-number">8</span> Review of linear algebra</a></li>
<li><a class="" href="linear-models.html"><span class="header-section-number">9</span> Linear models</a></li>
<li><a class="" href="anova.html"><span class="header-section-number">10</span> ANOVA</a></li>
<li><a class="" href="model-selection.html"><span class="header-section-number">11</span> Model Selection</a></li>
<li><a class="" href="principal-component-analysis.html"><span class="header-section-number">12</span> Principal Component Analysis</a></li>
<li><a class="" href="clustering.html"><span class="header-section-number">13</span> Clustering</a></li>
<li><a class="" href="generalized-linear-models.html"><span class="header-section-number">14</span> Generalized linear models</a></li>
<li><a class="active" href="machine-learning-methods-for-classification.html"><span class="header-section-number">15</span> Machine learning methods for classification</a></li>
<li><a class="" href="building-phylogeneric-trees.html"><span class="header-section-number">16</span> Building phylogeneric trees</a></li>
<li><a class="" href="time-series-modeling-and-forecasting.html"><span class="header-section-number">17</span> Time series: modeling and forecasting</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="machine-learning-methods-for-classification" class="section level1" number="15">
<h1>
<span class="header-section-number">Lecture 15</span> Machine learning methods for classification<a class="anchor" aria-label="anchor" href="#machine-learning-methods-for-classification"><i class="fas fa-link"></i></a>
</h1>
<div id="introduction-1" class="section level2" number="15.1">
<h2>
<span class="header-section-number">15.1</span> Introduction<a class="anchor" aria-label="anchor" href="#introduction-1"><i class="fas fa-link"></i></a>
</h2>
<p>The classification problem is a very common one in practice, and we have already seen the use of GLMs to systematically predict binary response variables. We have also used clustering to perform <em>unsupervised</em> learning, where we do not have any information about correct labels for data points. We now turn to <em>supervised</em> classification problems and introduce two different approaches: a Bayesian one and a tree-based one.</p>
</div>
<div id="naive-bayes-classifier" class="section level2" number="15.2">
<h2>
<span class="header-section-number">15.2</span> Naive Bayes classifier<a class="anchor" aria-label="anchor" href="#naive-bayes-classifier"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose that we wish to classify an observation into one of K classes, which means there is a response variable Y can take on K different values, or labels. Let <span class="math inline">\(π_k\)</span> be the <em>prior probability</em> that a randomly chosen observation comes from the k-th class. Let <span class="math inline">\(f_k(X) =Pr(X|Y = k)\)</span> be the density function of X for an observation that comes from the k-th class.</p>
<p>Assuming we have the prior probabilities and the conditional probability distributions of the observations within each category <span class="math inline">\(k\)</span>, we can use Bayes’ theorem to compute the probability of each class, given a set of observations <span class="math inline">\(x\)</span> by turning around the conditionality:</p>
<p><span class="math display">\[
P(Y = k | X = x) = \frac{\pi_k f_k(x)}{\sum_i^K \pi_i f_i(x)}
\]</span>
And let us use the notation <span class="math inline">\(p_k (x) = P(Y = k | X = x)\)</span> to mean the <em>posterior probability</em> that an observation <span class="math inline">\(x\)</span> belongs to class <span class="math inline">\(k\)</span>.</p>
<p>Let us use the penguin data as an example, where we want to classify the observations by species. Then, if we take a training set with known classifications, we can take the prior probabilities <span class="math inline">\(\pi_k\)</span> to be the fractions of observed birds of each species, and the probability distributions of each explanatory variable for each species <span class="math inline">\(f_k(X)\)</span> can be estimated from the observed distributions of the explanatory variables (flipper lengths, etc.) for Adelie, Gentoo, and Chinstrap subsets of observations.</p>
<p>The difficult part in the above example is estimating the distributions <span class="math inline">\(f_k(X)\)</span>, which is especially challenging for joint distributions of multiple variables. One method, called Linear Discriminant Analysis, assumes the distributions have the same covariance matrices for all classes and only differ in their mean values. Another, called Quadratic Discriminant Analysis, assumes different covariance matrices for different classes.</p>
<p>The Naive Bayes classifier instead assumes that within each class the explanatory variables <span class="math inline">\(X_i\)</span> are independent, and thus</p>
<p><span class="math display">\[
f_k(x) = f_{k1} (x_1) \times f_{k2} (x_2) \times ... \times f_{kn} (x_n)
\]</span></p>
<p>where <span class="math inline">\(f_{ki}(x_i)\)</span> is the probability distribution of the i-th explanatory variable <span class="math inline">\(x_i\)</span> for class <span class="math inline">\(k\)</span>.</p>
<p>This modifies the Bayes’ formula to look like this:</p>
<p><span class="math display">\[
P(Y = k | X = x) = \frac{\pi_k f_{k1} (x_1) \times f_{k2} (x_2) \times ... \times f_{kn} (x_n)}{\sum_i^K \pi_i f_{k1} (x_1) \times f_{k2} (x_2) \times ... \times f_{kn} (x_n)}
\]</span>
Although it looks more complicated, we can compute each distribution function separately, so as long as there is enough data in the training set to estimate each explanatory variable for each class, the calculation is manageable.</p>
<div id="penguin-data" class="section level3" number="15.2.1">
<h3>
<span class="header-section-number">15.2.1</span> Penguin data<a class="anchor" aria-label="anchor" href="#penguin-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb838"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"penguins"</span><span class="op">)</span></span>
<span><span class="va">pen_clean</span> <span class="op">&lt;-</span> <span class="va">penguins</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Fix the random numbers by setting the seed  for reproducibility</span></span>
<span><span class="co">#set.seed(314)</span></span>
<span><span class="co"># Put 3/4 of the data into the training set </span></span>
<span><span class="va">pen_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">pen_clean</span>, prop <span class="op">=</span> <span class="fl">3</span><span class="op">/</span><span class="fl">4</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data frames for the two sets:</span></span>
<span><span class="va">pen_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">pen_split</span><span class="op">)</span></span>
<span><span class="va">pen_test</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">pen_split</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb839"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb_spec</span> <span class="op">&lt;-</span> <span class="fu">naive_Bayes</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"naivebayes"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_args</span><span class="op">(</span>usekernel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  </span>
<span></span>
<span></span>
<span><span class="va">pen_recipe</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">pen_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">update_role</span><span class="op">(</span><span class="va">island</span>,  new_role <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span></span>
<span></span>
<span><span class="co">#nb_fit &lt;- nb_spec %&gt;% </span></span>
<span><span class="co">#  fit(Direction ~ Lag1 + Lag2, data =pen_</span></span>
<span></span>
<span><span class="va">pen_workflow_nb</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">nb_spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">pen_recipe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_nb</span> <span class="op">&lt;-</span> <span class="va">pen_workflow_nb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">fit</span><span class="op">(</span><span class="va">pen_train</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb840"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">fit_nb</span>, new_data <span class="op">=</span> <span class="va">pen_test</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">species</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>##            Truth
## Prediction  Adelie Chinstrap Gentoo
##   Adelie        28         1      0
##   Chinstrap      2        18      0
##   Gentoo         0         0     35</code></pre>
<div class="sourceCode" id="cb842"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/pkg/stablelearner/man/accuracy.html">accuracy</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="va">species</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy multiclass     0.964</code></pre>
</div>
<div id="breast-cancer-data" class="section level3" number="15.2.2">
<h3>
<span class="header-section-number">15.2.2</span> Breast cancer data<a class="anchor" aria-label="anchor" href="#breast-cancer-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb844"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span><span class="op">(</span><span class="st">"breastcancer"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html">glimpse</a></span><span class="op">(</span><span class="va">breastcancer</span><span class="op">)</span></span></code></pre></div>
<pre><code>## Rows: 699
## Columns: 10
## $ `Clump Thickness`             &lt;int&gt; 5, 5, 3, 6, 4, 8, 1, 2, 2, 4, 1, 2, 5, 1…
## $ `Uniformity of Cell Size`     &lt;int&gt; 1, 4, 1, 8, 1, 10, 1, 1, 1, 2, 1, 1, 3, …
## $ `Uniformity of Cell Shape`    &lt;int&gt; 1, 4, 1, 8, 1, 10, 1, 2, 1, 1, 1, 1, 3, …
## $ `Marginal Adhesion`           &lt;int&gt; 1, 5, 1, 1, 3, 8, 1, 1, 1, 1, 1, 1, 3, 1…
## $ `Single Epithelial Cell Size` &lt;int&gt; 2, 7, 2, 3, 2, 7, 2, 2, 2, 2, 1, 2, 2, 2…
## $ `Bare Nuclei`                 &lt;int&gt; 1, 10, 2, 4, 1, 10, 10, 1, 1, 1, 1, 1, 3…
## $ `Bland Chromatin`             &lt;int&gt; 3, 3, 3, 3, 3, 9, 3, 3, 1, 2, 3, 2, 4, 3…
## $ `Normal Nucleoli`             &lt;int&gt; 1, 2, 1, 7, 1, 7, 1, 1, 1, 1, 1, 1, 4, 1…
## $ Mitoses                       &lt;int&gt; 1, 1, 1, 1, 1, 1, 1, 1, 5, 1, 1, 1, 1, 1…
## $ Class                         &lt;fct&gt; benign, benign, benign, benign, benign, …</code></pre>
<div class="sourceCode" id="cb846"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">cancer_clean</span> <span class="op">&lt;-</span> <span class="va">breastcancer</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="https://tidyr.tidyverse.org/reference/drop_na.html">drop_na</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co"># Fix the random numbers by setting the seed  for reproducibility</span></span>
<span><span class="co">#set.seed(314)</span></span>
<span><span class="co"># Put 3/4 of the data into the training set </span></span>
<span><span class="va">can_split</span> <span class="op">&lt;-</span> <span class="fu">initial_split</span><span class="op">(</span><span class="va">cancer_clean</span>, prop <span class="op">=</span> <span class="fl">1</span><span class="op">/</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create data frames for the two sets:</span></span>
<span><span class="va">can_train</span> <span class="op">&lt;-</span> <span class="fu">training</span><span class="op">(</span><span class="va">can_split</span><span class="op">)</span></span>
<span><span class="va">can_test</span>  <span class="op">&lt;-</span> <span class="fu">testing</span><span class="op">(</span><span class="va">can_split</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb847"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">nb_spec</span> <span class="op">&lt;-</span> <span class="fu">naive_Bayes</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"naivebayes"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_args</span><span class="op">(</span>usekernel <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>  </span>
<span></span>
<span></span>
<span><span class="va">can_recipe</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">can_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">update_role</span><span class="op">(</span><span class="va">`Uniformity of Cell Shape`</span>,  <span class="va">`Uniformity of Cell Size`</span>, <span class="va">`Bland Chromatin`</span>, new_role <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span><span class="va">can_workflow_nb</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">nb_spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">can_recipe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">can_fit_nb</span> <span class="op">&lt;-</span> <span class="va">can_workflow_nb</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">fit</span><span class="op">(</span><span class="va">can_train</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb848"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">can_fit_nb</span>, new_data <span class="op">=</span> <span class="va">can_test</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Class</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>##            Truth
## Prediction  benign malignant
##   benign       204         3
##   malignant     10       125</code></pre>
<div class="sourceCode" id="cb850"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/pkg/stablelearner/man/accuracy.html">accuracy</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Class</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.962</code></pre>
</div>
</div>
<div id="decision-trees" class="section level2" number="15.3">
<h2>
<span class="header-section-number">15.3</span> Decision Trees<a class="anchor" aria-label="anchor" href="#decision-trees"><i class="fas fa-link"></i></a>
</h2>
<p>Suppose instead that we represent the classification process as a sequence of binary choices, that eventually lead to a category. This can be represented by a <em>decision tree</em>, whose <em>internal nodes</em> are separators of the space of observations (all the values of explanatory variables) that divide it into regions, and the <em>leaves</em> are the labels of these regions. (Decision trees can also be used for quantitative response variables, but we will focus on classification.) For example, here is a a decision tree for accepting a job offer:</p>
<div class="figure">
<img src="https://i1.wp.com/dataaspirant.com/wp-content/uploads/2017/01/B03905_05_01-compressor.png?resize=768%2C424&amp;ssl=1" alt=""><p class="caption">Do you want this job?</p>
</div>
<p>Building a decision tree for classification happens by sequential splitting the space of observations, starting with the decision that gives the most bang for the buck. Let us define the quality of the split into <span class="math inline">\(M\)</span> region by calculating how many observations in that regions actually belong to each category <span class="math inline">\(k\)</span>. The <em>Gini index</em> (or impurity) is defined as the product of the probability of an observation (in practice, the fraction of observations in the training set) being labeled correctly with label <span class="math inline">\(k\)</span> (<span class="math inline">\(p_k\)</span>) times the probability of it being labeled incorrectly (<span class="math inline">\(1-p_k\)</span>), summed over all the labels <span class="math inline">\(k\)</span>:</p>
<p><span class="math display">\[
G = \sum_k (1-p_k)p_k
\]</span></p>
<p>Alternatively, one can use the Shannon information or entropy measure:</p>
<p><span class="math display">\[
S = -\sum_k p_k log(p_k)
\]</span>
Notice that both measures are smallest when <span class="math inline">\(p_k\)</span> is close to 1 or 0, so they both tell the same story for a particular region: if (almost) all the points are points are either classified or incorrectly, these measures are close to 0.</p>
<div class="figure">
<img src="https://jakevdp.github.io/PythonDataScienceHandbook/figures/05.08-decision-tree-levels.png?resize=768%2C424&amp;ssl=1" alt=""><p class="caption">Recursive splitting of a two-dimensional set of observations</p>
</div>
<p>One of these measures is used to create the sequential splits in the training data set. The biggest problem with this decision tree method is that it’s a greedy algorithm that easily leads to overfitting: as you can see in the figure above, it can create really complicated regions in the observation space that may not correspond to meaningful distinctions.</p>
<div id="penguin-data-1" class="section level3" number="15.3.1">
<h3>
<span class="header-section-number">15.3.1</span> Penguin data<a class="anchor" aria-label="anchor" href="#penguin-data-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb852"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tree_spec</span> <span class="op">&lt;-</span> <span class="fu">decision_tree</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"rpart"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb853"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pen_recipe</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">pen_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">update_role</span><span class="op">(</span><span class="va">island</span>,  new_role <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pen_workflow_tree</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">tree_spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">pen_recipe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_tree</span> <span class="op">&lt;-</span> <span class="va">pen_workflow_tree</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">fit</span><span class="op">(</span><span class="va">pen_train</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb854"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">fit_tree</span>, new_data <span class="op">=</span> <span class="va">pen_test</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">species</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>##            Truth
## Prediction  Adelie Chinstrap Gentoo
##   Adelie        27         1      0
##   Chinstrap      3        16      0
##   Gentoo         0         2     35</code></pre>
<div class="sourceCode" id="cb856"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/pkg/stablelearner/man/accuracy.html">accuracy</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="va">species</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy multiclass     0.929</code></pre>
<div class="sourceCode" id="cb858"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_tree</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">extract_fit_engine</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">rpart.plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-355-1.png" width="672"></div>
</div>
<div id="breast-cancer-data-1" class="section level3" number="15.3.2">
<h3>
<span class="header-section-number">15.3.2</span> Breast cancer data<a class="anchor" aria-label="anchor" href="#breast-cancer-data-1"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb859"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">can_recipe</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">can_train</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">update_role</span><span class="op">(</span><span class="va">`Uniformity of Cell Shape`</span>,  <span class="va">`Uniformity of Cell Size`</span>, <span class="va">`Bland Chromatin`</span>, new_role <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span>  </span>
<span></span>
<span><span class="va">can_workflow_tree</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">tree_spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">can_recipe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_tree</span> <span class="op">&lt;-</span> <span class="va">can_workflow_tree</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">fit</span><span class="op">(</span><span class="va">can_train</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb860"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">fit_tree</span>, new_data <span class="op">=</span> <span class="va">can_test</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Class</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>##            Truth
## Prediction  benign malignant
##   benign       198         8
##   malignant     16       120</code></pre>
<div class="sourceCode" id="cb862"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/pkg/stablelearner/man/accuracy.html">accuracy</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Class</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.930</code></pre>
<div class="sourceCode" id="cb864"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_tree</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">extract_fit_engine</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">rpart.plot</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-358-1.png" width="672"></div>
</div>
</div>
<div id="random-forests" class="section level2" number="15.4">
<h2>
<span class="header-section-number">15.4</span> Random Forests<a class="anchor" aria-label="anchor" href="#random-forests"><i class="fas fa-link"></i></a>
</h2>
<p>Overfitting usually results from modeling meaningless noise in the data instead of real differences. This gave rise to the idea to “shake up” the algorithm and see if the splits it produces are robust if the training set is different. In fact, let’s use multiple trees and look at what the consensus of the <em>ensemble</em> can produce. This approach is called <em>bagging</em>, which makes use of an random ensemble of parallel classifiers, each of which over-fits the data, it combines the results to find a better classification. An ensemble of randomized decision trees is known as a <em>random forest</em>.</p>
<p>Essentially, the process is as follows: use random sampling from the data set (bootstrapping) to generate different training sets and train different decision trees on each. Then for each observation, find its consensus classification among the whole ensemble; that is, how does the plurality of the trees classify it.</p>
<p>Since each data point is left out of a number of trees, one can estimate an unbiased error of classification by computing the “out-of-bag” error: for each observation, used the classification produced by all the trees that did not have this one points in the bag. This is basically a built-in cross-validation measure.</p>
<div id="penguin-data-2" class="section level3" number="15.4.1">
<h3>
<span class="header-section-number">15.4.1</span> Penguin data<a class="anchor" aria-label="anchor" href="#penguin-data-2"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb865"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf_spec</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span>mtry <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb866"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf_recipe</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">species</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">pen_clean</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">update_role</span><span class="op">(</span><span class="va">island</span>,  new_role <span class="op">=</span> <span class="st">"ID"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pen_workflow_rf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">rf_spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">pen_recipe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_rf</span> <span class="op">&lt;-</span> <span class="va">pen_workflow_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">fit</span><span class="op">(</span><span class="va">pen_clean</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb867"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">fit_rf</span>, new_data <span class="op">=</span> <span class="va">pen_clean</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">species</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>##            Truth
## Prediction  Adelie Chinstrap Gentoo
##   Adelie       144         1      0
##   Chinstrap      2        67      0
##   Gentoo         0         0    119</code></pre>
<div class="sourceCode" id="cb869"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/pkg/stablelearner/man/accuracy.html">accuracy</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="va">species</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy multiclass     0.991</code></pre>
<p>Importance measures of different variables:</p>
<div class="sourceCode" id="cb871"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">last_rf</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rand_forest</span><span class="op">(</span>mtry <span class="op">=</span> <span class="fl">4</span>, trees <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span>,  importance <span class="op">=</span> <span class="st">"impurity"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span><span class="co"># the last workflow</span></span>
<span><span class="va">last_workflow</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">pen_workflow_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">last_rf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the last fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">last_rf_fit</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">last_workflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">last_fit</span><span class="op">(</span><span class="va">pen_split</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb872"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">last_rf_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy multiclass     0.964 Preprocessor1_Model1
## 2 roc_auc  hand_till      0.998 Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb874"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">last_rf_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">".workflow"</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   </span>
<span>  <span class="fu">pull_workflow_fit</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">vip</span><span class="op">(</span>num_features <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-363-1.png" width="672"></div>
</div>
<div id="cancer-data" class="section level3" number="15.4.2">
<h3>
<span class="header-section-number">15.4.2</span> Cancer data<a class="anchor" aria-label="anchor" href="#cancer-data"><i class="fas fa-link"></i></a>
</h3>
<div class="sourceCode" id="cb875"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rf_spec</span> <span class="op">&lt;-</span> <span class="fu">rand_forest</span><span class="op">(</span>mtry <span class="op">=</span> <span class="fl">4</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb876"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">can_rf_recipe</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">recipe</span><span class="op">(</span><span class="va">Class</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">cancer_clean</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">can_workflow_rf</span> <span class="op">&lt;-</span> <span class="fu">workflow</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_model</span><span class="op">(</span><span class="va">rf_spec</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">add_recipe</span><span class="op">(</span><span class="va">can_rf_recipe</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit_rf</span> <span class="op">&lt;-</span> <span class="va">can_workflow_rf</span>  <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">fit</span><span class="op">(</span><span class="va">cancer_clean</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb877"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">fit_rf</span>, new_data <span class="op">=</span> <span class="va">can_test</span><span class="op">)</span> </span>
<span></span>
<span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> <span class="fu">conf_mat</span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Class</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>##            Truth
## Prediction  benign malignant
##   benign       210         1
##   malignant      4       127</code></pre>
<div class="sourceCode" id="cb879"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">compare_pred</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>  <span class="fu"><a href="https://rdrr.io/pkg/stablelearner/man/accuracy.html">accuracy</a></span><span class="op">(</span>truth <span class="op">=</span> <span class="va">Class</span>, estimate <span class="op">=</span> <span class="va">.pred_class</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   .metric  .estimator .estimate
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt;
## 1 accuracy binary         0.985</code></pre>
<p>Importance measures of different variables:</p>
<div class="sourceCode" id="cb881"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">last_rf</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">rand_forest</span><span class="op">(</span>mtry <span class="op">=</span> <span class="fl">4</span>, trees <span class="op">=</span> <span class="fl">100</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_engine</span><span class="op">(</span><span class="st">"ranger"</span>,  importance <span class="op">=</span> <span class="st">"impurity"</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">set_mode</span><span class="op">(</span><span class="st">"classification"</span><span class="op">)</span></span>
<span><span class="co"># the last workflow</span></span>
<span><span class="va">last_workflow</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">can_workflow_rf</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">update_model</span><span class="op">(</span><span class="va">last_rf</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># the last fit</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="va">last_rf_fit</span> <span class="op">&lt;-</span> </span>
<span>  <span class="va">last_workflow</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">last_fit</span><span class="op">(</span><span class="va">can_split</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb882"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">last_rf_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">collect_metrics</span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<pre><code>## # A tibble: 2 × 4
##   .metric  .estimator .estimate .config             
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;               
## 1 accuracy binary         0.956 Preprocessor1_Model1
## 2 roc_auc  binary         0.992 Preprocessor1_Model1</code></pre>
<div class="sourceCode" id="cb884"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">last_rf_fit</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://purrr.tidyverse.org/reference/pluck.html">pluck</a></span><span class="op">(</span><span class="st">".workflow"</span>, <span class="fl">1</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span>   </span>
<span>  <span class="fu">pull_workflow_fit</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">vip</span><span class="op">(</span>num_features <span class="op">=</span> <span class="fl">20</span><span class="op">)</span></span></code></pre></div>
<div class="inline-figure"><img src="BIOS_26318_2020_files/figure-html/unnamed-chunk-368-1.png" width="672"></div>
</div>
</div>
<div id="references-2" class="section level2" number="15.5">
<h2>
<span class="header-section-number">15.5</span> References<a class="anchor" aria-label="anchor" href="#references-2"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li><p><a href="https://www.statlearning.com/">Introduction to Statistical Learning</a></p></li>
<li><p><a href="https://emilhvitfeldt.github.io/ISLR-tidymodels-labs/">Introcution to Statistical Learning Labs with Tidymodels</a></p></li>
<li><p><a href="https://www.tidymodels.org/start/case-study/">Tidy models tutorial</a></p></li>
<li><p><a href="https://dataaspirant.com/how-decision-tree-algorithm-works/">How Decision Trees Work</a></p></li>
<li><p><a href="https://jakevdp.github.io/PythonDataScienceHandbook/05.08-random-forests.html">Python Data Science Handbook</a></p></li>
<li><p><a href="https://towardsdatascience.com/rfviz-an-interactive-visualization-package-for-random-forests-in-r-8fb71709c8bf">Visualization of Random Forests</a></p></li>
</ol>
</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="generalized-linear-models.html"><span class="header-section-number">14</span> Generalized linear models</a></div>
<div class="next"><a href="building-phylogeneric-trees.html"><span class="header-section-number">16</span> Building phylogeneric trees</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#machine-learning-methods-for-classification"><span class="header-section-number">15</span> Machine learning methods for classification</a></li>
<li><a class="nav-link" href="#introduction-1"><span class="header-section-number">15.1</span> Introduction</a></li>
<li>
<a class="nav-link" href="#naive-bayes-classifier"><span class="header-section-number">15.2</span> Naive Bayes classifier</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#penguin-data"><span class="header-section-number">15.2.1</span> Penguin data</a></li>
<li><a class="nav-link" href="#breast-cancer-data"><span class="header-section-number">15.2.2</span> Breast cancer data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#decision-trees"><span class="header-section-number">15.3</span> Decision Trees</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#penguin-data-1"><span class="header-section-number">15.3.1</span> Penguin data</a></li>
<li><a class="nav-link" href="#breast-cancer-data-1"><span class="header-section-number">15.3.2</span> Breast cancer data</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#random-forests"><span class="header-section-number">15.4</span> Random Forests</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#penguin-data-2"><span class="header-section-number">15.4.1</span> Penguin data</a></li>
<li><a class="nav-link" href="#cancer-data"><span class="header-section-number">15.4.2</span> Cancer data</a></li>
</ul>
</li>
<li><a class="nav-link" href="#references-2"><span class="header-section-number">15.5</span> References</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>Fundamentals of Biological Data Analysis</strong>" was written by Dmitry Kondrashov and Stefano Allesina. It was last built on 2022-09-26.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
